<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Classificaci贸 - Club de Pesca Torres de Segre</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Classificaci贸 oficial del Club de Pesca Torres de Segre."/>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<header>
  <div class="container">
    <nav>
      <div class="logo"> Club de Pesca Torres de Segre</div>
      <div class="nav-links">
        <a href="index.html">Inici</a>
        <a href="classificacio.html" class="active">Classificaci贸</a>
        <a href="calendari.html">Calendari</a>
        <a href="normes.html">Normes</a>
        <a href="botiga.html">Botiga</a>
        <a href="galeria.html">Galeria</a>
        <a href="contacte.html">Contacte</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <div class="card">
    <div class="table-top">
      <div>
        <h1>Classificaci贸 final</h1>
        <p class="descripcio">Punts totals acumulats (fi de temporada).</p>
      </div>

      <div class="table-actions">
        <input id="q" type="search" placeholder="Cercar pescador..." aria-label="Cercar" />
        <button id="toggleSort" title="Ordenar per punts / posici贸">Ordena per punts</button>
      </div>
    </div>

    <div class="table-wrap" role="region" aria-label="Taula de classificaci贸" tabindex="0">
      <table class="pro-table" id="table">
        <thead>
          <tr>
            <th data-col="pos">P</th>
            <th data-col="nom">Nom</th>
            <th data-col="punts">Puntuaci贸 final</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</main>

<footer>
  Club de Pesca Torres de Segre 路 Lliga Individual 2025
</footer>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZr7Rh9h9mnykdAranLV3Z1p3PErucd-qZOBpxYMOqrA-xfAXxmRkL1zKHOWB2vsYSwcXnkf1DR-U/pub?output=csv";

const tbody = document.getElementById("rows");
const q = document.getElementById("q");
const toggleSort = document.getElementById("toggleSort");

let data = [];
let sortByPoints = false;

function render(){
  const query = (q.value || "").toLowerCase().trim();

  let rows = data.filter(r => (r.nom || "").toLowerCase().includes(query));

  rows.sort((a,b) => {
    if (sortByPoints) return (b.punts - a.punts) || (a.pos - b.pos);
    return a.pos - b.pos;
  });

  tbody.innerHTML = rows.map(r => `
    <tr>
      <td><strong>${r.pos}</strong></td>
      <td>${(r.nom || "").replaceAll('"','')}</td>
      <td><strong>${r.punts}</strong></td>
    </tr>
  `).join("");
}

async function loadData() {
  const res = await fetch(csvUrl, { cache: "no-store" }); // evita cach茅 fuerte
  const text = await res.text();

  const rows = text.trim().split("\n").slice(1);

  return rows.map(r => {
    const cols = r.split(",");
    return {
      pos: Number(cols[0]),
      nom: (cols[1] || "").trim(),
      punts: Number(cols[2])
    };
  });
}

async function init(){
  data = await loadData();
  render();
}

q.addEventListener("input", render);

toggleSort.addEventListener("click", () => {
  sortByPoints = !sortByPoints;
  toggleSort.textContent = sortByPoints ? "Ordena per posici贸" : "Ordena per punts";
  render();
});

init();
</script>



</body>
</html>
